# Генератор Release Notes из JIRA CSV

Этот скрипт автоматизирует создание документа Release Notes в формате `.docx` на основе CSV-файла, экспортированного из JIRA.

## Основные возможности

*   Чтение задач из CSV-файла.
*   Автоматическое определение версий компонентов и глобальной версии релиза (опционально).
*   Гибкая настройка включаемых полей и их отображения.
*   Настройка стилей документа (шрифты, размеры).
*   Группировка задач по микросервисам и типам задач.
*   Автоматическая сортировка.
*   Формирование разделов "Перечень изменений" и "Настройки системы".
*   Логирование процесса выполнения.

## Требования

*   Python 3.8+
*   Библиотеки: `pandas`, `python-docx`, `packaging` (см. `requirements.txt`)

## Установка

1.  Клонируйте репозиторий или скачайте файлы проекта.
2.  Создайте и активируйте виртуальное окружение (рекомендуется):
    ```bash
    python -m venv .venv
    # Windows: .venv\Scripts\activate
    # macOS/Linux: source .venv/bin/activate
    ```
3.  Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```

## Структура проекта

*   `main.py`: Основной запускаемый скрипт (в корне проекта).
*   `src/`: Содержит все модули скрипта (`config_loader.py`, `csv_parser.py`, `data_processor.py`, `report_generator.py`, `logger_config.py`).
*   `configs/`: Папка с конфигурационными JSON-файлами.
    *   `config.json`: Основные настройки (пути, версии, настройки автоопределения, заголовки).
    *   `fields_mapping.json`: Определение того, какие поля из CSV включать в отчет и как их называть.
    *   `word_styles.json`: Настройки шрифтов, размеров и других стилей для Word-документа.
*   `data/`: Рекомендуемая папка для хранения входных CSV-файлов.
*   `output/`: Папка, куда по умолчанию сохраняются сгенерированные `.docx` отчеты.
*   `assets/`: Рекомендуемая папка для хранения логотипа (если используется).

## Конфигурация

Перед первым запуском необходимо настроить файлы в папке `configs/`:

1.  **`config.json`**:
    *   `input_csv_file`: Путь к вашему CSV-файлу (относительно корня проекта, например, `"data/jira_export.csv"`).
    *   `output_report_file_docx`: Шаблон имени выходного файла (например, `"output/Release_Notes_{global_release_version}.docx"`).
    *   `auto_detect_global_version` (true/false): Включить автоопределение глобальной версии из CSV.
    *   `global_release_version`: Глобальная версия (используется, если автоопределение выключено или не удалось).
    *   `auto_detect_component_versions` (true/false): Включить автоопределение версий компонентов для таблицы.
    *   `microservices_versions_for_table`: Список версий компонентов (используется, если автоопределение выключено).
    *   `microservice_source_field_csv`: Название колонки в CSV, содержащей версии (например, `"Fix Version/s"`).
    *   `microservice_prefix_mapping`: Словарь для сопоставления префиксов версий с полными именами микросервисов (например, `{"AM": "phobos-AFM"}`).
    *   Настройки сортировки (`sort_...`) и заголовков разделов (`report_section_titles`).

2.  **`fields_mapping.json`**:
    *   Описывает, какие колонки из CSV использовать. Каждая запись – объект с полями:
        *   `csv_header`: Точное название колонки в CSV.
        *   `internal_name`: Внутреннее имя поля, используемое в скрипте.
        *   `report_label`: Отображаемое имя поля в отчете (если применимо).
        *   `include_in_task_details` (true/false): Включать ли это поле в детали задачи в разделе "Перечень изменений".
        *   `order_in_task_details`: Порядок отображения (если несколько полей выводятся).

3.  **`word_styles.json`**:
    *   Настройка шрифтов (`fonts`), размеров (`font_sizes` в пунктах), отступов (`paragraph_spacing`), цветов (`colors_hex`) и свойств таблиц (`table_properties`).

## Подготовка CSV

*   Экспортируйте задачи из JIRA в формат CSV.
*   Убедитесь, что названия колонок в CSV соответствуют `csv_header` в `fields_mapping.json`.
*   Если для одной задачи указано несколько версий в поле "Fix Version/s", JIRA может создать несколько колонок с одинаковым базовым именем (например, "Fix Version/s", "Fix Version/s.1"). В `config.json` в `microservice_source_field_csv` укажите базовое имя ("Fix Version/s").

## Запуск

1.  Убедитесь, что вы находитесь в корневой директории проекта.
2.  Активируйте виртуальное окружение (если используете).
3.  Выполните команду:
    ```bash
    python main.py
    ```
4.  Сгенерированный `.docx` файл будет находиться в папке, указанной в `output_report_file_docx` (по умолчанию `output/`).
5.  Логи выполнения будут выводиться в консоль и, если настроено в `src/logger_config.py`, в файл (по умолчанию `release_notes_generator.log` в корне проекта).

## Устранение неполадок

*   **`FileNotFoundError`**: Проверьте пути в `config.json` к CSV-файлу и файлу логотипа. Убедитесь, что файлы существуют.
*   **`ImportError`**: Убедитесь, что вы правильно установили все зависимости из `requirements.txt` в активном виртуальном окружении и запускаете скрипт из корневой директории проекта.
*   **Микросервисы или версии не определяются**: Проверьте `microservice_prefix_mapping` в `config.json` и формат данных в колонке `Fix Version/s` вашего CSV. Включите DEBUG уровень логирования в `src/logger_config.py` для детальной информации.